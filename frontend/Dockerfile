# Use Node.js Alpine
FROM node:18-alpine

# Set working directory
WORKDIR /app

# Define environment variables as build arguments
ARG VITE_VALUE_TEST
ARG VITE_AGENTS_API
ARG VITE_ARCHIVE_API
ARG VITE_WORKFLOW_API
ARG VITE_TICKET_API
ARG VITE_ADMINTICKET_API
ARG VITE_ARCHIVE_TICKETS_API
ARG VITE_UPCOMING_TICKETS_API
ARG VITE_LOGIN_API
ARG VITE_VERIFY_API
ARG VITE_VERIFY_OTP_API
ARG VITE_BACKEND_API
ARG VITE_USER_SERVER_API
ARG VITE_LOGOUT_API

# Export environment variables for build
ENV VITE_VALUE_TEST=${VITE_VALUE_TEST}
ENV VITE_AGENTS_API=${VITE_AGENTS_API}
ENV VITE_ARCHIVE_API=${VITE_ARCHIVE_API}
ENV VITE_WORKFLOW_API=${VITE_WORKFLOW_API}
ENV VITE_TICKET_API=${VITE_TICKET_API}
ENV VITE_ADMINTICKET_API=${VITE_ADMINTICKET_API}
ENV VITE_ARCHIVE_TICKETS_API=${VITE_ARCHIVE_TICKETS_API}
ENV VITE_UPCOMING_TICKETS_API=${VITE_UPCOMING_TICKETS_API}
ENV VITE_LOGIN_API=${VITE_LOGIN_API}
ENV VITE_VERIFY_API=${VITE_VERIFY_API}
ENV VITE_VERIFY_OTP_API=${VITE_VERIFY_OTP_API}
ENV VITE_BACKEND_API=${VITE_BACKEND_API}
ENV VITE_USER_SERVER_API=${VITE_USER_SERVER_API}
ENV VITE_LOGOUT_API=${VITE_LOGOUT_API}

# Install dependencies
COPY package*.json ./
RUN npm install

# Copy project files
COPY . .

# Build app
RUN npm run build

# Install global dependencies
RUN npm install -g serve json-server

# Copy and prepare startup script
COPY start.sh .
RUN chmod +x start.sh

# Expose ports (adjust if needed)
EXPOSE 5000 1000

# Start application
CMD ["sh", "start.sh"]
