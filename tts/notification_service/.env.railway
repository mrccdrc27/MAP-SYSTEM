# Railway Production Environment Variables for notification_service

# =================================================================
# CRITICAL: Set these variables in Railway Dashboard
# =================================================================

# Django Core Settings
DJANGO_ENV=production
DJANGO_DEBUG=False
DJANGO_SECRET_KEY=<generate-with-python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'>
DJANGO_ALLOWED_HOSTS=<your-railway-app>.railway.app,notification-service.railway.app
DJANGO_JWT_SIGNING_KEY=<your-jwt-key>

# Database (Railway PostgreSQL)
# Railway automatically provides DATABASE_URL - no need to set manually
# DATABASE_URL=postgresql://postgres:password@host:port/database

# Gmail API Configuration (REQUIRED)
# 1. Copy the entire content of credentials.json as a single line JSON string
# 2. Set GMAIL_OAUTH_CREDENTIALS to that JSON string
GMAIL_OAUTH_CREDENTIALS={"installed":{"client_id":"...","project_id":"...","auth_uri":"...","token_uri":"...","client_secret":"...","redirect_uris":["..."]}}
GMAIL_SENDER_EMAIL=your-email@gmail.com
DJANGO_DEFAULT_FROM_EMAIL=noreply@notifications.com

# Celery & RabbitMQ
# Railway CloudAMQP addon provides this automatically
# Or use Railway's internal RabbitMQ service
DJANGO_CELERY_BROKER_URL=amqp://user:pass@host:port/vhost
DJANGO_NOTIFICATION_QUEUE=notification-queue
DJANGO_INAPP_NOTIFICATION_QUEUE=inapp-notification-queue

# CORS Configuration
DJANGO_CORS_ALLOWED_ORIGINS=https://your-frontend-domain.com,https://your-railway-frontend.railway.app
DJANGO_CSRF_TRUSTED_ORIGINS=https://your-frontend-domain.com,https://your-railway-frontend.railway.app

# Service URLs
DJANGO_AUTH_SERVICE_URL=https://your-auth-service.railway.app
DJANGO_NOTIFICATION_API_KEYS=your-secure-api-key-1,your-secure-api-key-2

# Optional: Sentry for Error Tracking
# SENTRY_DSN=https://xxx@xxx.ingest.sentry.io/xxx

# =================================================================
# Initial Token Setup for Railway
# =================================================================
# 
# After deploying to Railway:
# 
# 1. Run the authentication flow ONCE locally:
#    python authenticate_gmail.py
# 
# 2. This creates token.json with OAuth token
# 
# 3. Get the token data from token.json:
#    cat token.json
# 
# 4. In Railway, run a one-time migration to store the token:
#    railway run python manage.py shell
#    
#    Then in the shell:
#    from notifications.token_storage import GmailToken
#    from django.utils import timezone
#    from datetime import timedelta
#    
#    token_data = {
#        'token': '<access_token_from_token.json>',
#        'refresh_token': '<refresh_token_from_token.json>',
#        'token_uri': 'https://oauth2.googleapis.com/token',
#        'client_id': '<from_credentials.json>',
#        'client_secret': '<from_credentials.json>',
#    }
#    
#    GmailToken.save_token(
#        service_email='your-email@gmail.com',
#        token_data=token_data,
#        refresh_token='<refresh_token_from_token.json>',
#        expires_at=timezone.now() + timedelta(hours=1)
#    )
#    
# 5. Token will auto-refresh when expired
# 
# =================================================================
# Railway Deployment Commands
# =================================================================
# 
# Build Command: (Railway auto-detects)
# pip install -r requirements.txt
# 
# Start Command:
# gunicorn notification_service.wsgi:application --bind 0.0.0.0:$PORT
# 
# Celery Worker (separate service):
# celery -A notification_service worker --pool=solo --loglevel=info -Q NOTIFICATION_TASKS,inapp-notification-queue
# 
# Run Migrations:
# python manage.py migrate
# 
# Collect Static Files:
# python manage.py collectstatic --noinput
# 
# =================================================================
