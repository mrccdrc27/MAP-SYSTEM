{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - Authentication System</title>

    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static 'css/forgot_password.css' %}" rel="stylesheet">
</head>
<body class="passwordResetPage">
    <div class="leftPanel">
        <!-- Left side - Optional Image -->
        <section class="leftPanel">
            <div class="leftImage">
                <img src="{% static 'images/TTS_MAP_BG.png' %}" alt="Background" class="assetImage">
            </div>
        </section>
    </div>

    <div class="rightPanel">
        <header class="formHeader">
            <section class="logo">
                <img src="{% static 'images/map-logo.png' %}" alt="TicketFlow logo" />
                <h1 class="logoText">TicketFlow</h1>
            </section>
            <p class="text-muted">Enter your email to reset your password</p>
        </header>

        <!-- Messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {% if message.tags == 'error' %}
                        <i class="fas fa-exclamation-triangle me-2"></i>
                    {% elif message.tags == 'success' %}
                        <i class="fas fa-check-circle me-2"></i>
                    {% elif message.tags == 'warning' %}
                        <i class="fas fa-exclamation-circle me-2"></i>
                    {% else %}
                        <i class="fas fa-info-circle me-2"></i>
                    {% endif %}
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}

        <!-- Forgot Password Form -->
        <form method="post" class="lpForm" novalidate>
            {% csrf_token %}
            
            <!-- Email Field -->
            <fieldset>
                <label for="{{ form.email.id_for_label }}">
                    Email Address
                </label>
                {{ form.email }}
                {% if form.email.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.email.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
                <div class="form-text">
                    We'll send you a password reset link if this email is associated with an account
                </div>
            </fieldset>

            <!-- Submit Button -->
            <button type="submit" class="logInButton mb-3">
                <i class="fas fa-paper-plane me-2"></i>Send Reset Link
            </button>

            <!-- Form Errors -->
            {% if form.non_field_errors %}
                <div class="alert alert-danger form-error">
                    {% for error in form.non_field_errors %}
                        <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
                    {% endfor %}
                </div>
            {% endif %}

        </form>

        <!-- Additional Links -->
        <div class="forgotPassword">
            <a href="{{ login_url }}" class="text-decoration-none">
                <i class="fas fa-arrow-left me-1"></i>Back to Login
            </a>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-dismiss alerts after 5 seconds
            const alerts = document.querySelectorAll('.alert:not(.alert-info)');
            alerts.forEach(alert => {
                setTimeout(() => {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }, 5000);
            });

            // Form validation feedback
            const form = document.querySelector('.lpForm');
            form.addEventListener('submit', function(e) {
                const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;

                // Validate required fields
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        field.classList.add('is-invalid');
                        isValid = false;
                    } else {
                        field.classList.remove('is-invalid');
                        field.classList.add('is-valid');
                    }
                });

                if (!isValid) {
                    e.preventDefault();
                }
            });

            // Real-time field validation
            const inputs = form.querySelectorAll('input[required]');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    if (this.value.trim()) {
                        this.classList.remove('is-invalid');
                        this.classList.add('is-valid');
                    } else {
                        this.classList.add('is-invalid');
                        this.classList.remove('is-valid');
                    }
                });

                input.addEventListener('input', function() {
                    if (this.classList.contains('is-invalid') && this.value.trim()) {
                        this.classList.remove('is-invalid');
                        this.classList.add('is-valid');
                    }
                });
            });
        });
    </script>
</body>
</html>
